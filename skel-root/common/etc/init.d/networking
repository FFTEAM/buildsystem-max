#!/bin/sh

# manage network interfaces and configure some networking options

PATH=/sbin:/bin:/usr/sbin:/usr/bin

case "$1" in
    start)
	if ! type ifplugd >/dev/null 2>&1; then
		echo -n "Configuring network interfaces... "
		ifup -a
	else
		echo -n "Starting ifplugd... "
		test $(ip a show dev lo|wc -l) -lt 4 && ifup lo
		ifplugd -F
	fi
	echo "done."
	;;
    stop)
	if test -e /var/run/ifplugd.eth0.pid; then # todo: multiple interfaces...
		echo -n "Stopping ifplugd... "
		kill -TERM $(cat /var/run/ifplugd.eth0.pid)
		for i in 1 2 3 4 5 6 7 8 9 0; do
			test -e /var/run/ifplugd.eth0.pid || break
			sleep 1
		done
	else
		echo -n "Deconfiguring network interfaces... "
		ifdown -a
	fi
	echo "done."
	;;
    force-reload|restart)
	echo "Reconfiguring network interfaces... "
	$0 stop
	$0 start
	echo "...done."
	;;
esac

exit 0

